<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивная Карта</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, sans-serif; }
        .main-container { display: flex; height: 100vh; }
        
        /* Левая панель с иконками */
        .icons-panel {
            width: 120px; background: #2a2a2a; padding: 20px 10px; 
            overflow-y: auto; border-right: 2px solid #444;
        }
        .icon-item {
            width: 50px; height: 50px; margin: 8px auto; cursor: grab;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));
            transition: transform 0.2s;
        }
        .icon-item:hover { transform: scale(1.1); }
        .icon-item:active { cursor: grabbing; }
        
        /* Карта */
        #map { flex: 1; background: #222; }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Левая панель иконок -->
        <div class="icons-panel" id="iconsPanel"></div>
        
        <!-- Карта -->
        <div id="map"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- НАСТРОЙКА КАРТЫ ---
        const imgWidth = 6348;
        const imgHeight = 7418;
        const imgUrl = 'map.png';

        const map = L.map('map', { crs: L.CRS.Simple, minZoom: -5, maxZoom: 5 });
        const bounds = [[0, 0], [imgHeight, imgWidth]];
        L.imageOverlay(imgUrl, bounds).addTo(map);
        map.fitBounds(bounds);

        // --- ПАРАМЕТРЫ ГЕКСА (в координатах карты) ---
        // Подставь реальные значения после замера по кликам.
        // Пока примерные числа, чтобы схема работала.
        const HEX_WIDTH = 415;   // расстояние между центрами соседних гексов по X
        const HEX_HEIGHT = 415;  // расстояние между центрами по Y

        // Масштаб иконки относительно гекса: 0.6 = 60% стороны
        const ICON_SCALE = 0.6;

        // --- СПИСОК ИКОНок ---
        const ICON_FILES = ['test.svg'];

        function loadIcons() {
            const iconsPanel = document.getElementById('iconsPanel');

            ICON_FILES.forEach(filename => {
                const icon = document.createElement('div');
                icon.className = 'icon-item';
                icon.draggable = true;
                icon.dataset.filename = filename;

                const img = document.createElement('img');
                img.src = `icons/${filename}`;
                img.alt = filename;
                img.style.width = '100%';
                img.style.height = '100%';

                icon.appendChild(img);
                icon.addEventListener('dragstart', handleDragStart);
                iconsPanel.appendChild(icon);
            });
        }

        // --- DRAG & DROP ИЗ ПАНЕЛИ ---
        let draggedIcon = null;

        function handleDragStart(e) {
            const el = e.currentTarget;
            const filename = el.dataset.filename;
            if (!filename) return;

            draggedIcon = filename;
            e.dataTransfer.setData('text/plain', filename);
            el.style.opacity = '0.5';
        }

        map.getContainer().addEventListener('dragover', e => {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
        });

        map.getContainer().addEventListener('drop', function(e) {
            e.preventDefault();

            const filename = e.dataTransfer.getData('text/plain');
            if (!filename) return;

            const latlng = map.mouseEventToLatLng(e); // точка на карте
            addHexIconOverlay(filename, latlng);
        });

        // --- ИКОНКА КАК OVERLAY ФИКСИРОВАННОГО РАЗМЕРА ОТНОСИТЕЛЬНО ГЕКСА ---
        function addHexIconOverlay(filename, centerLatLng) {
            const iconUrl = `icons/${filename}`;

            const halfH = HEX_HEIGHT * ICON_SCALE / 2;
            const halfW = HEX_WIDTH * ICON_SCALE / 2;

            const bounds = [
                [centerLatLng.lat - halfH, centerLatLng.lng - halfW],
                [centerLatLng.lat + halfH, centerLatLng.lng + halfW]
            ];

            L.imageOverlay(iconUrl, bounds, {
                interactive: true   // можно будет вешать клики
            }).addTo(map);
        }

        // --- ОТЛАДКА: ПОСМОТРЕТЬ КООРДИНАТЫ КЛИКА ---
        map.on('click', e => console.log("Координаты:", e.latlng));

        // ИНИЦИАЛИЗАЦИЯ
        loadIcons();
    </script>
</body>
</html>
